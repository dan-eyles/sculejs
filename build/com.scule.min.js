var Scule={namespaces:{}};(function(){Scule.registerNamespace=function(t,e){if(Scule.hasOwnProperty(t)){throw"namespace "+t+" is already registered"}Scule[t]=e};Scule.registerComponent=function(t,e,i,n){var r=Scule.require(t);if(!r.hasOwnProperty(e)){throw"type "+e+" is not registered inside "+t+" namespace"}r[e][i]=n};Scule.require=function(t){if(!Scule.hasOwnProperty(t)){throw"namespace "+t+" has not been registered, require failed"}return Scule[t]};Scule.registerNamespace("global",{constants:{ID_FIELD:"_id",REF_FIELD:"_ref",OBJECT_WILDCARD:"*"},classes:{},functions:{},system:{},variables:{debug:false}});Scule.registerNamespace("datastructures",{constants:Scule.require("global").constants,classes:{},variables:{}});Scule.registerNamespace("instrumentation",{constants:Scule.require("global").constants,classes:{}});Scule.registerNamespace("interpreter",{functions:{},classes:{},objects:{},variables:{},symbols:{table:{}},arities:{expression:-1,logical:0,binary:1,selective:2,negative:3,range:4,mutate:5,array:6,geospatial:7,variable:8,operand:9,index:10},constants:Scule.require("global").constants});Scule.registerNamespace("db",{constants:Scule.require("global").constants,functions:{},classes:{},plugins:{},engines:{},objects:{core:{collections:{}}}});Scule.registerNamespace("events",{functions:{},classes:{},objects:{}});Scule.registerNamespace("messaging",{functions:{},classes:{},objects:{}})})();(function(){Scule.global.classes.sha1=function(){this.hexcase=0;this.b64pad="";this.hex_sha1=function(t){return this.rstr2hex(this.rstr_sha1(this.str2rstr_utf8(t)))};this.hash=function(t){return this.hex_sha1(t)};this.b64_sha1=function(t){return this.rstr2b64(this.rstr_sha1(this.str2rstr_utf8(t)))};this.any_sha1=function(t,e){return this.rstr2any(this.rstr_sha1(this.str2rstr_utf8(t)),e)};this.hex_hmac_sha1=function(t,e){return this.rstr2hex(this.rstr_hmac_sha1(this.str2rstr_utf8(t),this.str2rstr_utf8(e)))};this.b64_hmac_sha1=function(t,e){return this.rstr2b64(this.rstr_hmac_sha1(this.str2rstr_utf8(t),this.str2rstr_utf8(e)))};this.any_hmac_sha1=function(t,e,i){return this.rstr2any(this.rstr_hmac_sha1(this.str2rstr_utf8(t),this.str2rstr_utf8(e)),i)};this.sha1_vm_test=function(){return this.hex_sha1("abc").toLowerCase()=="a9993e364706816aba3e25717850c26c9cd0d89d"};this.rstr_sha1=function(t){return this.binb2rstr(this.binb_sha1(this.rstr2binb(t),t.length*8))};this.rstr_hmac_sha1=function(t,e){var i=this.rstr2binb(t);if(i.length>16){i=this.binb_sha1(i,t.length*8)}var n=new Array(16),r=new Array(16);for(var s=0;s<16;s++){n[s]=i[s]^909522486;r[s]=i[s]^1549556828}var a=this.binb_sha1(n.concat(this.rstr2binb(e)),512+e.length*8);return this.binb2rstr(this.binb_sha1(r.concat(a),512+160))};this.rstr2hex=function(t){this.hexcase=0;var e=this.hexcase?"0123456789ABCDEF":"0123456789abcdef";var i="";var n;for(var r=0;r<t.length;r++){n=t.charCodeAt(r);i+=e.charAt(n>>>4&15)+e.charAt(n&15)}return i};this.rstr2b64=function(t){this.b64pad="";var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var i="";var n=t.length;for(var r=0;r<n;r+=3){var s=t.charCodeAt(r)<<16|(r+1<n?t.charCodeAt(r+1)<<8:0)|(r+2<n?t.charCodeAt(r+2):0);for(var a=0;a<4;a++){if(r*8+a*6>t.length*8){i+=this.b64pad}else{i+=e.charAt(s>>>6*(3-a)&63)}}}return i};this.rstr2any=function(t,e){var i=e.length;var n=[];var r,s,a,u;var c=new Array(Math.ceil(t.length/2));for(r=0;r<c.length;r++){c[r]=t.charCodeAt(r*2)<<8|t.charCodeAt(r*2+1)}while(c.length>0){u=[];a=0;for(r=0;r<c.length;r++){a=(a<<16)+c[r];s=Math.floor(a/i);a-=s*i;if(u.length>0||s>0){u[u.length]=s}}n[n.length]=a;c=u}var l="";for(r=n.length-1;r>=0;r--){l+=e.charAt(n[r])}var o=Math.ceil(t.length*8/(Math.log(e.length)/Math.log(2)));for(r=l.length;r<o;r++){l=e[0]+l}return l};this.str2rstr_utf8=function(t){var e="";var i=-1;var n,r;while(++i<t.length){n=t.charCodeAt(i);r=i+1<t.length?t.charCodeAt(i+1):0;if(55296<=n&&n<=56319&&56320<=r&&r<=57343){n=65536+((n&1023)<<10)+(r&1023);i++}if(n<=127){e+=String.fromCharCode(n)}else if(n<=2047){e+=String.fromCharCode(192|n>>>6&31,128|n&63)}else if(n<=65535){e+=String.fromCharCode(224|n>>>12&15,128|n>>>6&63,128|n&63)}else if(n<=2097151){e+=String.fromCharCode(240|n>>>18&7,128|n>>>12&63,128|n>>>6&63,128|n&63)}}return e};this.str2rstr_utf16le=function(t){var e="";for(var i=0;i<t.length;i++){e+=String.fromCharCode(t.charCodeAt(i)&255,t.charCodeAt(i)>>>8&255)}return e};this.str2rstr_utf16be=function(t){var e="";for(var i=0;i<t.length;i++){e+=String.fromCharCode(t.charCodeAt(i)>>>8&255,t.charCodeAt(i)&255)}return e};this.rstr2binb=function(t){var e=new Array(t.length>>2);var i=null;for(i=0;i<e.length;i++){e[i]=0}for(i=0;i<t.length*8;i+=8){e[i>>5]|=(t.charCodeAt(i/8)&255)<<24-i%32}return e};this.binb2rstr=function(t){var e="";for(var i=0;i<t.length*32;i+=8){e+=String.fromCharCode(t[i>>5]>>>24-i%32&255)}return e};this.binb_sha1=function(t,e){t[e>>5]|=128<<24-e%32;t[(e+64>>9<<4)+15]=e;var i=new Array(80);var n=1732584193;var r=-271733879;var s=-1732584194;var a=271733878;var u=-1009589776;for(var c=0;c<t.length;c+=16){var l=n;var o=r;var h=s;var f=a;var g=u;for(var d=0;d<80;d++){if(d<16){i[d]=t[c+d]}else{i[d]=this.bit_rol(i[d-3]^i[d-8]^i[d-14]^i[d-16],1)}var S=this.safe_add(this.safe_add(this.bit_rol(n,5),this.sha1_ft(d,r,s,a)),this.safe_add(this.safe_add(u,i[d]),this.sha1_kt(d)));u=a;a=s;s=this.bit_rol(r,30);r=n;n=S}n=this.safe_add(n,l);r=this.safe_add(r,o);s=this.safe_add(s,h);a=this.safe_add(a,f);u=this.safe_add(u,g)}return new Array(n,r,s,a,u)};this.sha1_ft=function(t,e,i,n){if(t<20){return e&i|~e&n}if(t<40){return e^i^n}if(t<60){return e&i|e&n|i&n}return e^i^n};this.sha1_kt=function(t){return t<20?1518500249:t<40?1859775393:t<60?-1894007588:-899497514};this.safe_add=function(t,e){var i=(t&65535)+(e&65535);var n=(t>>16)+(e>>16)+(i>>16);return n<<16|i&65535};this.bit_rol=function(t,e){return t<<e|t>>>32-e}};Scule.global.classes.md5=function(){this.md5cycle=function(t,e){var i=t[0],n=t[1],r=t[2],s=t[3];i=this.ff(i,n,r,s,e[0],7,-680876936);s=this.ff(s,i,n,r,e[1],12,-389564586);r=this.ff(r,s,i,n,e[2],17,606105819);n=this.ff(n,r,s,i,e[3],22,-1044525330);i=this.ff(i,n,r,s,e[4],7,-176418897);s=this.ff(s,i,n,r,e[5],12,1200080426);r=this.ff(r,s,i,n,e[6],17,-1473231341);n=this.ff(n,r,s,i,e[7],22,-45705983);i=this.ff(i,n,r,s,e[8],7,1770035416);s=this.ff(s,i,n,r,e[9],12,-1958414417);r=this.ff(r,s,i,n,e[10],17,-42063);n=this.ff(n,r,s,i,e[11],22,-1990404162);i=this.ff(i,n,r,s,e[12],7,1804603682);s=this.ff(s,i,n,r,e[13],12,-40341101);r=this.ff(r,s,i,n,e[14],17,-1502002290);n=this.ff(n,r,s,i,e[15],22,1236535329);i=this.gg(i,n,r,s,e[1],5,-165796510);s=this.gg(s,i,n,r,e[6],9,-1069501632);r=this.gg(r,s,i,n,e[11],14,643717713);n=this.gg(n,r,s,i,e[0],20,-373897302);i=this.gg(i,n,r,s,e[5],5,-701558691);s=this.gg(s,i,n,r,e[10],9,38016083);r=this.gg(r,s,i,n,e[15],14,-660478335);n=this.gg(n,r,s,i,e[4],20,-405537848);i=this.gg(i,n,r,s,e[9],5,568446438);s=this.gg(s,i,n,r,e[14],9,-1019803690);r=this.gg(r,s,i,n,e[3],14,-187363961);n=this.gg(n,r,s,i,e[8],20,1163531501);i=this.gg(i,n,r,s,e[13],5,-1444681467);s=this.gg(s,i,n,r,e[2],9,-51403784);r=this.gg(r,s,i,n,e[7],14,1735328473);n=this.gg(n,r,s,i,e[12],20,-1926607734);i=this.hh(i,n,r,s,e[5],4,-378558);s=this.hh(s,i,n,r,e[8],11,-2022574463);r=this.hh(r,s,i,n,e[11],16,1839030562);n=this.hh(n,r,s,i,e[14],23,-35309556);i=this.hh(i,n,r,s,e[1],4,-1530992060);s=this.hh(s,i,n,r,e[4],11,1272893353);r=this.hh(r,s,i,n,e[7],16,-155497632);n=this.hh(n,r,s,i,e[10],23,-1094730640);i=this.hh(i,n,r,s,e[13],4,681279174);s=this.hh(s,i,n,r,e[0],11,-358537222);r=this.hh(r,s,i,n,e[3],16,-722521979);n=this.hh(n,r,s,i,e[6],23,76029189);i=this.hh(i,n,r,s,e[9],4,-640364487);s=this.hh(s,i,n,r,e[12],11,-421815835);r=this.hh(r,s,i,n,e[15],16,530742520);n=this.hh(n,r,s,i,e[2],23,-995338651);i=this.ii(i,n,r,s,e[0],6,-198630844);s=this.ii(s,i,n,r,e[7],10,1126891415);r=this.ii(r,s,i,n,e[14],15,-1416354905);n=this.ii(n,r,s,i,e[5],21,-57434055);i=this.ii(i,n,r,s,e[12],6,1700485571);s=this.ii(s,i,n,r,e[3],10,-1894986606);r=this.ii(r,s,i,n,e[10],15,-1051523);n=this.ii(n,r,s,i,e[1],21,-2054922799);i=this.ii(i,n,r,s,e[8],6,1873313359);s=this.ii(s,i,n,r,e[15],10,-30611744);r=this.ii(r,s,i,n,e[6],15,-1560198380);n=this.ii(n,r,s,i,e[13],21,1309151649);i=this.ii(i,n,r,s,e[4],6,-145523070);s=this.ii(s,i,n,r,e[11],10,-1120210379);r=this.ii(r,s,i,n,e[2],15,718787259);n=this.ii(n,r,s,i,e[9],21,-343485551);t[0]=this.add32(i,t[0]);t[1]=this.add32(n,t[1]);t[2]=this.add32(r,t[2]);t[3]=this.add32(s,t[3])};this.cmn=function(t,e,i,n,r,s){e=this.add32(this.add32(e,t),this.add32(n,s));return this.add32(e<<r|e>>>32-r,i)};this.ff=function(t,e,i,n,r,s,a){return this.cmn(e&i|~e&n,t,e,r,s,a)};this.gg=function(t,e,i,n,r,s,a){return this.cmn(e&n|i&~n,t,e,r,s,a)};this.hh=function(t,e,i,n,r,s,a){return this.cmn(e^i^n,t,e,r,s,a)};this.ii=function(t,e,i,n,r,s,a){return this.cmn(i^(e|~n),t,e,r,s,a)};this.md51=function(t){if(/[\x80-\xFF]/.test(t)){t=unescape(encodeURI(t))}var e=t.length,i=[1732584193,-271733879,-1732584194,271733878],n;for(n=64;n<=t.length;n+=64){this.md5cycle(i,this.md5blk(t.substring(n-64,n)))}t=t.substring(n-64);var r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(n=0;n<t.length;n++){r[n>>2]|=t.charCodeAt(n)<<(n%4<<3)}r[n>>2]|=128<<(n%4<<3);if(n>55){this.md5cycle(i,r);for(n=0;n<16;n++){r[n]=0}}r[14]=e*8;this.md5cycle(i,r);return i};this.md5blk=function(t){var e=[],i;for(i=0;i<64;i+=4){e[i>>2]=t.charCodeAt(i)+(t.charCodeAt(i+1)<<8)+(t.charCodeAt(i+2)<<16)+(t.charCodeAt(i+3)<<24)}return e};this.hex_chr="0123456789abcdef".split("");this.rhex=function(t){var e="",i=0;for(;i<4;i++){e+=this.hex_chr[t>>i*8+4&15]+this.hex_chr[t>>i*8&15]}return e};this.hex=function(t){for(var e=0;e<t.length;e++){t[e]=this.rhex(t[e])}return t.join("")};this.hash=function(t){return this.hex(this.md51(t))};this.add32=function(t,e){return t+e&4294967295}};Scule.global.system.installHashFunctions=function(){Scule.md5=new Scule.global.classes.md5;Scule.sha1=new Scule.global.classes.sha1}})();(function(){Scule.global.functions.hasOwnProperty=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)};Scule.global.functions.getObjectId=function(t,e){if(e===undefined){e=false}return e?t[Scule.global.constants.ID_FIELD].toString():t[Scule.global.constants.ID_FIELD]};Scule.global.functions.cloneObject=function(t){var e={};if(Scule.global.functions.isArray(t)){e=[]}for(var i in t){if(typeof t[i]==="object"){if(t[i]instanceof RegExp){e[i]=new RegExp(t[i].toString())}else{e[i]=Scule.global.functions.cloneObject(t[i])}}else{e[i]=t[i]}}return e};Scule.global.functions.traverseObject=function(t,e){var i=0;var n=null;var r=function(t){for(var e in t){if(Scule.global.functions.hasOwnProperty(t,e)){if(t[e]===true){n=e;break}else{i++;r(t[e])}}}};r(t);var s=0;var a=function(t,e){if(s===i){return e}for(var n in t){if(Scule.global.functions.hasOwnProperty(t,n)){if(!Scule.global.functions.hasOwnProperty(e,n)){return null}if(t[n]===true){return e}else{s++;return a(t[n],e[n])}}}};return[n,a(t,e)]};Scule.global.functions.sortObjectKeys=function(t){var e={};var i=[];for(var n in t){if(Scule.global.functions.hasOwnProperty(t,n)){i.push(n)}}i.sort(function(t,e){var i=false;if(t.match(/^\$/)){t=t.substr(1);i=true}var n=false;if(e.match(/^\$/)){e=e.substr(1);n=true}if(i&&!n){return 1}else if(n&&!i){return-1}if(e>t){return-1}else{return 1}});i.forEach(function(i){e[i]=t[i]});return e};Scule.global.functions.objectKeys=function(t){var e=[];for(var i in t){if(!Scule.global.functions.hasOwnProperty(t,i)){continue}e.push(i)}return e};Scule.global.functions.sizeOf=function(t){if(t instanceof Array||typeof t==="string"){return t.length}var e=0,i;for(i in t){if(Scule.global.functions.hasOwnProperty(t,i)){e++}}return e};Scule.global.functions.shuffle=function(t){var e,i,n=t.length;if(n){while(--n){i=Math.floor(Math.random()*(n+1));e=t[i];t[i]=t[n];t[n]=e}}};Scule.global.functions.contains=function(t,e){return Scule.global.functions.hasOwnProperty(t,e)};Scule.global.functions.isArray=function(t){return Object.prototype.toString.call(t)==="[object Array]"};Scule.global.functions.isInteger=function(t){return parseInt(t,10)==t};Scule.global.functions.isDouble=function(t){return parseFloat(t)==t};Scule.global.functions.isScalar=function(t){return t!==null&&!(t instanceof Object)};Scule.global.functions.randomFromTo=function(t,e){return Math.floor(Math.random()*(e-t+1)+t)};Scule.global.functions.compare=function(t,e){if(t===e){return 0}return t>e?1:-1};Scule.global.functions.sort=function(t,e,i){switch(t){case-1:e.sort(function(t,e){return e[i]-t[i]});break;case 0:Scule.global.functions.shuffle(e);break;case 1:e.sort(function(t,e){return t[i]-e[i]});break;case 2:e.sort(function(t,e){if(e[i]>t[i]){return-1}else if(e[i]<t[i]){return 1}else{return 0}});break;case 3:e.reverse();break}};Scule.global.functions.trim=function(t){if(!String.prototype.trim){return t.replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g,"").replace(/\s+/g," ")}else{return t.trim()}};Scule.global.functions.getMACAddress=function(){if(!Scule.global.variables.hasOwnProperty("SimulatedMacAddress")){Scule.global.variables.SimulatedMacAddress=(new Date).getTime().toString().substring(9,11)+""+Scule.global.functions.randomFromTo(100,999)}return Scule.global.variables.SimulatedMacAddress};Scule.global.functions.parseAttributes=function(t){if(!Scule.global.functions.isArray(t)){return Scule.global.functions.parseAttributes(t.split(","))}var e=function(t,i,n){var r=Scule.global.functions.trim(i[n]);if(n===i.length-1){t[r]=true}else{var s={};t[r]=s;e(s,i,n+1)}};var i={};t.forEach(function(t){e(i,t.split("."),0)});return i};Scule.global.functions.traverse=function(t,e){var i=function(t,e){if(e===undefined){return undefined}if(t.length===1){return e[t.pop()]}else{var n=t.shift();return i(t,e[n])}};return i(t.split("."),e)}})();(function(){Scule.datastructures.variables.fnv_hash=function(t,e){var i=2166136261;var n=16777619;var r=t.length;for(var s=0;s<r;s++){i=(i^t.charCodeAt(s))*n}i+=i<<13;i^=i>>7;i+=i<<3;i^=i>>17;i+=i<<5;if(i<0){i=i*-1}return i%e};Scule.datastructures.variables.djb2_hash=function(t,e){var i=5381;var n=t.length;var r=0;for(r=0;r<n;r++){i=(i<<5)+i+t.charCodeAt(r)}if(i<0){i=i*-1}return i%e};Scule.datastructures.classes.LinkedList=function(){this.head=null;this.tail=null;this.length=0;this.getHead=function(){return this.head};this.getTail=function(){return this.tail};this.getLength=function(){return this.length};this.isEmpty=function(){return this.length===0};this.clear=function(){this.head=null;this.tail=null;this.length=0};this.get=function(t){if(t<0||t>this.length){return null}if(t===0){return this.head}else{var e=this.head;var i=0;while(e){if(t===i){break}i++;e=e.next}return e}};this.add=function(t){var e=new Scule.datastructures.classes.LinkedListNode(null,t);if(this.head===null){this.head=e}else if(this.tail===null){this.head.next=e;this.tail=e}else{var i=this.tail;i.next=e;this.tail=i.next}this.length++;return e};this.search=function(t,e,i){if(!i){i=Scule.global.functions.compare}var n=this.head;while(n){if(e){if(i(n.element[e],t)===0){break}}else{if(i(n.element,t)===0){break}}n=n.next}return n};this.contains=function(t,e){if(t===null){return false}if(!e){e=Scule.global.functions.compare}var i=this.head;while(i){if(e(i.element,t)===0){break}i=i.next}return i!==null};this.split=function(t){var e;if(t===undefined){t=Math.floor(this.length/2);e=this.middle();if(!e){return null}}else{if(t<1||t>this.length){return null}e=this.get(t-1)}var i=new Scule.datastructures.classes.LinkedList;i.head=e.next;e.next=null;i.tail=this.tail;this.tail=e;i.length=t;this.length=this.length-t;return i};this.middle=function(){if(!this.head){return null}var t=this.head;var e=this.head;while(e.next&&e.next.next){t=t.next;e=e.next.next}return t};this.remove=function(t){if(t<0||t>this.length){return null}var e;if(this.length===1){e=this.head;this.clear()}else{var i=this.get(t-1);if(i.next==this.tail){e=this.tail;this.tail=i}else{e=i.next;i.next=i.next.next}this.length--}return e};this.trim=function(){if(this.isEmpty()){return null}return this.remove(this.length-1)};this.reverse=function(){var t=null;var e=this.head;var i=null;while(e){i=e.next;e.next=t;t=e;e=i}i=this.head;this.head=this.tail;this.tail=i};this.toArray=function(){var t=[];var e=this.head;while(e){t.push(e.element);e=e.next}return t};this.forEach=function(t){var e=this.head;while(e){t(e);e=e.next}return true};this.sort=function(t,e){if(this.length<2){return this}if(!t){t=Scule.global.functions.compare}var i=function(t){if(!t){return t}var e=t;var i=t;while(i.next&&i.next.next){e=e.next;i=i.next.next}return e};var n=function(i,n){var r={next:null};var s=r;var a;var u;while(i&&n){if(e){a=n.element[e];u=i.element[e]}else{a=n.element;u=i.element}if(t(a,u)>-1){s.next=i;i=i.next}else{s.next=n;n=n.next}s=s.next}s.next=!i?n:i;return r.next};var r=function(t){if(!t||!t.next){return t}var e=i(t);var s=e.next;e.next=null;return n(r(t),r(s))};this.head=r(this.head)}};Scule.datastructures.classes.DoublyLinkedList=function(){this.head=null;this.tail=null;this.length=0;this.getHead=function(){return this.head};this.getTail=function(){return this.tail};this.isEmpty=function(){return this.length===0};this.getLength=function(){return this.length};this.search=function(t,e,i){if(!i){i=Scule.global.functions.compare}var n=this.head;while(n){if(e){if(i(n.element[e],t)===0){break}}else{if(i(n.element,t)===0){break}}n=n.next}return n};this.contains=function(t,e){if(t===null){return false}if(!e){e=Scule.global.functions.compare}var i=this.head;while(i){if(e(i.element,t)===0){break}i=i.next}return i!==null};this.get=function(t){if(t<0||t>this.length){return null}if(t===0){return this.head}else{var e=this.head;var i=0;while(e){if(t===i){break}i++;e=e.next}return e}};this.add=function(t){var e=new Scule.datastructures.classes.DoublyLinkedListNode(null,null,t);if(this.isEmpty()){this.head=e}else if(!this.tail){this.tail=e;this.tail.prev=this.head;this.head.next=e}else{var i=this.tail;i.next=e;e.prev=i;this.tail=e}this.length++;return e};this.remove=function(t){if(t<0||t>this.length){return null}var e;if(this.length===1){e=this.head;this.clear()}else{var i=this.get(t-1);if(i.next==this.tail){e=this.tail;this.tail=i;this.tail.prev=e.prev;this.tail.next=null}else{e=i.next;i.next=i.next.next;if(i.next){i.next.prev=i}}this.length--}if(e){e.detach()}return e};this.trim=function(){if(this.isEmpty()){return null}return this.remove(this.length-1)};this.split=function(t){var e;if(t===undefined){t=Math.floor(this.length/2);e=this.middle();if(!e){return null}}else{if(t<1||t>this.length){return null}e=this.get(t-1)}var i=new Scule.datastructures.classes.DoublyLinkedList;i.head=e.next;e.next=null;e.prev=null;i.tail=this.tail;this.tail=e;i.length=t;this.length=this.length-t;return i};this.middle=function(){if(!this.head){return null}var t=this.head;var e=this.head;while(e.next&&e.next.next){t=t.next;e=e.next.next}return t};this.sort=function(t,e){if(this.length<2){return this}if(!t){t=Scule.global.functions.compare}var i=function(t){if(!t){return t}var e=t;var i=t;while(i.next&&i.next.next){e=e.next;i=i.next.next}return e};var n=function(i,n){var r={next:null};var s=r;var a;var u;while(i&&n){if(e){a=n.element[e];u=i.element[e]}else{a=n.element;u=i.element}if(t(a,u)>-1){s.next=i;s.prev=n;i=i.next}else{s.next=n;s.prev=i;n=n.next}s=s.next}s.next=!i?n:i;return r.next};var r=function(t){if(!t||!t.next){return t}var e=i(t);var s=e.next;e.next=null;s.prev=null;return n(r(t),r(s))};this.head=r(this.head)};this.reverse=function(){var t=this.head;var e=null;while(t){e=t.next;t.next=t.prev;t.prev=e;t=e}e=this.head;this.head=this.tail;this.tail=e};this.prepend=function(t){var e=new Scule.datastructures.classes.DoublyLinkedListNode(null,null,t);if(this.isEmpty()){this.head=e}else{var i=this.head;this.head=e;i.prev=this.head;this.head.next=i;if(!this.tail){this.tail=i}}this.length++;return e};this.clear=function(){this.head=null;this.tail=null;this.length=0};this.toArray=function(){var t=[];var e=this.head;while(e){t.push(e.element);e=e.next}return t};this.forEach=function(t){var e=this.head;while(e){t(e);e=e.next}return true}};Scule.datastructures.classes.CachingLinkedList=function(t,e,i){if(!e){throw"A valid cache key is required to use a CachingLinkedList"}if(!t){t=100}this.cacheKey=e;this.threshold=t;this.cache=new Scule.datastructures.classes.LRUCache(t);if(!i){i=new Scule.datastructures.classes.LinkedList}this.list=i;this.clear=function(){this.cache.clear();this.list.clear()};this.remove=function(t){var e=this.list.remove(t);if(e){this.cache.remove(e.element[this.cacheKey])}return e};this.middle=function(){return this.list.middle()};this.split=function(){this.cache.clear();return this.list.split()};this.add=function(t){var e=this.list.add(t);this.cache.put(e.element[this.cacheKey],e);return e};this.search=function(t){if(this.cache.contains(t)){return this.cache.get(t)}var e=this.list.search(t,this.cacheKey);if(e){this.cache.put(e.element[this.cacheKey],e)}return e};this.getLength=function(){return this.list.getLength()};this.getTail=function(){return this.list.getTail()};this.getHead=function(){return this.list.getHead()};this.isEmpty=function(){return this.list.isEmpty()};this.get=function(t){return this.list.get(t)};this.contains=function(t){return this.list.contains(t)};this.reverse=function(){this.list.reverse()};this.sort=function(t){this.list.sort(t,this.cacheKey)};this.toArray=function(){return this.list.toArray()};this.forEach=function(t){return this.list.forEach(t)}};Scule.datastructures.classes.LinkedListNode=function(t,e){this.next=t;this.element=e;this.getNext=function(){return this.next};this.setNext=function(t){this.next=t};this.getElement=function(){return this.element};this.setElement=function(t){this.element=t}};Scule.datastructures.classes.DoublyLinkedListNode=function(t,e,i){Scule.datastructures.classes.LinkedListNode.call(this,e,i);this.prev=t;this.getPrev=function(){return this.prev};this.setPrev=function(t){this.prev=t};this.detach=function(){this.prev=null;this.next=null}};Scule.datastructures.classes.LRUCache=function(t){this.threshold=t;this.cache=new Scule.datastructures.classes.HashTable;this.queue=new Scule.datastructures.classes.DoublyLinkedList;this.contains=function(t){return this.cache.contains(t)};this.remove=function(t){if(!this.cache.contains(t)){return null}var e=this.cache.get(t);this.cache.remove(t);var i=e.node.prev;var n=e.node.next;if(i){i.next=n}if(n){n.prev=i}e.node.detach();this.queue.length--;return true};this.get=function(t){if(!this.cache.contains(t)){return null}var e=this.cache.get(t);e.requeue(this.queue);return e.value};this.put=function(t,e){var i;if(this.cache.contains(t)){i=this.cache.get(t);i.value=e;i.node.element={key:t,value:e};i.requeue(this.queue)}else{i=new Scule.datastructures.classes.LRUCacheEntry(t,e,this.queue.prepend({key:t,value:e}));this.cache.put(t,i)}if(this.queue.length>this.threshold){var n=this.queue.trim();if(!this.cache.remove(n.getElement().key)){throw"LRU cache is corrupt"}n=null}return true};this.getLength=function(){return this.cache.getLength()};this.clear=function(){this.cache.clear();this.queue.clear()}};Scule.datastructures.classes.LRUCacheEntry=function(t,e,i){this.key=t;this.value=e;this.node=i;this.getKey=function(){return this.key};this.getValue=function(){return this.value};this.getNode=function(){return this.node};this.requeue=function(t){if(!this.node.prev){return}var e=this.node.prev;var i=this.node.next;e.next=i;if(i){i.prev=e}this.node.detach();t.length--;this.node=t.prepend({key:this.key,value:this.value})}};Scule.datastructures.classes.LIFOStack=function(){Scule.datastructures.classes.LinkedList.call(this);this.push=function(t){var e=this.head;this.head=new Scule.datastructures.classes.LinkedListNode(e,t);this.length++};this.pop=function(){if(this.isEmpty()){return null}var t=this.head;this.head=t.next;this.length--;t.next=null;return t.getElement()};this.peek=function(){if(this.isEmpty()){return null}return this.head.getElement()}};Scule.datastructures.classes.FIFOStack=function(){Scule.datastructures.classes.LIFOStack.call(this);this.push=this.add;this.pop=function(){if(this.isEmpty()){return null}var t=this.head;this.head=t.next;this.length--;return t.getElement()}};Scule.datastructures.classes.Queue=function(){Scule.datastructures.classes.FIFOStack.call(this);this.enqueue=this.push;this.dequeue=this.pop};Scule.datastructures.classes.HashMap=function(t){this.size=t;this.buckets=0;this.length=0;this.table=[];this.hash=Scule.datastructures.variables.djb2_hash;this.retable=function(){var t=this.length/this.size;if(this.length>=this.buckets&&t<.7){return}var e=this.toArray();this.clear();this.size=this.size*2;for(var i=0;i<e.length;i++){this.put(e[i][0],e[i][1])}};this.bucket=function(t){if(!this.table[t]){this.buckets++;this.table[t]=new Scule.datastructures.classes.BinarySearchTree}return this.table[t]};this.put=function(t,e){var i=this.hash(t,this.size);var n=this.bucket(i);var r=n.insert(t,e);if(r){this.length++;if(n.getLength()%10===0){n.balance()}}this.retable();return r};this.contains=function(t){var e=this.hash(t,this.size);var i=this.bucket(e);return i.search(t)!==null};this.get=function(t){var e=this.hash(t,this.size);var i=this.bucket(e);var n=i.search(t);if(n===null){return null}return n.getData()};this.search=function(t){return this.get(t)};this.remove=function(t){var e=this.hash(t,this.size);var i=this.bucket(e);if(i.remove(t)){this.length--;this.retable();return true}else{return false}};this.clear=function(){this.table=[];this.length=0;this.buckets=0};this.getLength=function(){return this.length};this.getKeys=function(){var t=[];var e=function(i){if(i===null){return}t.push(i.getKey());e(i.getLeft());e(i.getRight())};this.table.forEach(function(t){if(!t){return}e(t.getRoot())});return t};this.getValues=function(){var t=[];var e=function(i){if(i===null){return}t.push(i.getData());e(i.getLeft());e(i.getRight())};this.table.forEach(function(t){if(!t){return}e(t.getRoot())});return t};this.toArray=function(){var t=[];this.table.forEach(function(e){if(!e){return}t=t.concat(e.toArray())});return t}};Scule.datastructures.classes.HashTable=function(){this.table={};this.length=0;this.put=function(t,e){if(!this.contains(t)){this.length++}this.table[t]=e};this.get=function(t){if(this.contains(t)){return this.table[t]}return null};this.search=function(t){return this.get(t)};this.remove=function(t){if(this.contains(t)){var e=this.table[t];delete this.table[t];this.length--;return e}return false};this.contains=function(t){return Scule.global.functions.hasOwnProperty(this.table,t)};this.clear=function(){this.table={};this.length=0};this.getLength=function(){return this.length};this.getKeys=function(){var t=[];for(var e in this.table){if(this.contains(e)){t.push(e)}}return t};this.getValues=function(){var t=[];for(var e in this.table){if(this.contains(e)){t.push(this.table[e])}}return t};this.toArray=function(){var t=[];for(var e in this.table){if(this.contains(e)){t[e]=this.table[e]}}return t}};Scule.datastructures.classes.BinarySearchTreeNode=function(t,e){this.parent=null;this.left=null;this.right=null;this.key=t;this.data=e;this.setParent=function(t){this.parent=t};this.getParent=function(){return this.parent};this.setLeft=function(t){if(!t){return}this.left=t;this.left.setParent(this)};this.getLeft=function(){return this.left};this.setRight=function(t){if(!t){return}this.right=t;this.right.setParent(this)};this.getRight=function(){return this.right};this.getKey=function(){return this.key};this.setData=function(t){this.data=t};this.getData=function(){return this.data};this.clear=function(){this.data=null};this.remove=function(t){if(!t){return false}if(t==this.right){this.setRight(t.getRight());this.getRight().setLeft(t.getLeft());t.parent=null;t.left=null;t.right=null;return true}else if(t==this.left){this.setLeft(t.getRight());this.getLeft().setLeft(t.getLeft());t.parent=null;t.left=null;t.right=null;return true}return false}};Scule.datastructures.classes.AtomicCounter=function(t){if(t===undefined){t=0}if(!Scule.global.functions.isInteger(t)){throw"Unable to initialize counter with non-integer value"}this.count=t;this.increment=function(t){if(t===undefined){t=1}if(!Scule.global.functions.isInteger(t)){throw"Unable to increment counter with non-integer value"}this.count+=t;return this.count};this.decrement=function(t){if(t===undefined){t=1}if(!Scule.global.functions.isInteger(t)){throw"Unable to decrement counter with non-integer value"}this.count-=t;return this.count};this.getCount=function(){return this.count}};Scule.datastructures.classes.BinarySearchTree=function(){this.root=null;this.length=0;this.insert=function(t,e){var i=this;var n=new Scule.datastructures.classes.BinarySearchTreeNode(t,e);if(this.root===null){this.length++;this.root=n;return true}var r=function(t,e){if(t.getKey()==e.getKey()){e.setData(t.getData());return false}if(t.getKey()<=e.getKey()){if(!e.getLeft()){i.length++;e.setLeft(t)}else{r(t,e.getLeft())}}else{if(!e.getRight()){i.length++;e.setRight(t)}else{r(t,e.getRight())}}return true};return r(n,this.root)};this.search=function(t){var e=function(t,i){if(!i){return null}if(i.getKey()==t){return i}else if(i.getKey()>t){return e(t,i.getLeft())}else{return e(t,i.getRight())}};return e(t,this.root)};this.remove=function(t){var e=this.search(t);if(!e){return false}if(!e.getParent()){if(e.getRight()){this.root=e.getRight();this.root.setLeft(e.getLeft())}else if(e.getLeft()){this.root=e.getRight();this.root.setLeft(e.getLeft())}else{this.root=null}this.length--;return true}var i=e.getParent().remove(e);if(i){this.length--}return i};this.balance=function(){var t=this;var e=this.toArray();var i=function(e){var n=e;var r=e.splice(Math.ceil(e.length/2),e.length);var s=n.pop();t.insert(s[0],s[1]);if(n.length>0){i(n)}if(r.length>0){i(r)}};this.length=0;this.root=null;i(e)};this.getLength=function(){return this.length};this.toArray=function(){var t=function(e){if(!e){return[]}return t(e.getLeft()).concat([[e.getKey(),e.getData()]]).concat(t(e.getRight()))};return t(this.root)};this.getRoot=function(){return this.root};this.clear=function(){this.root=null;this.length=0}};Scule.datastructures.classes.BitSet=function(t){if(t===undefined||!Scule.global.functions.isInteger(t)||t<=0){throw"Unable to initialize bitset with non-integer capacity"}this.capacity=t;this.words=null;this.zeroFill=function(){this.words=[];var t=Math.ceil(this.capacity/32);for(var e=0;e<=t;e++){this.words[e]=0}};this.indexToAddress=function(t){if(t<0||t>=this.capacity){throw"Index out of bounds"}if(t<32){return{addr:0,offs:t}}var e=Math.floor(t/32);var i=t%32;return{addr:e,offs:i}};this.get=function(t){var e=this.indexToAddress(t);return(this.words[e.addr]&1<<e.offs)!==0};this.set=function(t){var e=this.indexToAddress(t);this.words[e.addr]|=1<<e.offs};this.clear=function(t){var e=this.indexToAddress(t);this.words[e.addr]&=~(1<<e.offs)};this.getLength=function(){return this.capacity};this.toString=function(){var t="";for(var e=0;e<this.capacity;e++){t+=this.get(e)?1:0}return t};this.zeroFill()};Scule.datastructures.classes.BloomFilter=function(t,e){if(t===undefined||!Scule.global.functions.isInteger(t)||t<=0){throw"Unable to initialize bloom filter with non-integer m"}if(e===undefined||!Scule.global.functions.isInteger(e)||e<=0){e=Math.floor(t/Math.ceil(t/3))}Scule.datastructures.classes.BitSet.call(this,t);this.k=e;this.f=[];for(var i=0;i<this.k;i++){this.f.push([Scule.global.functions.randomFromTo(0,999999),Scule.global.functions.randomFromTo(0,999999)])}this.hash=function(t,e,i){return Scule.datastructures.variables.fnv_hash(this.f[t][0]+e+this.f[t][1],i)};this.add=function(t){for(var e=0;e<this.k;e++){this.set(this.hash(e,t,this.capacity))}};this.query=function(t){for(var e=0;e<this.k;e++){if(!this.get(this.hash(e,t,this.capacity))){return false}}return true}};Scule.datastructures.classes.AtomicCounter=function(t){if(t===undefined){t=0}if(!Scule.global.functions.isInteger(t)){throw"Unable to initialize counter with non-integer value"
}this.count=t;this.increment=function(t){if(t===undefined){t=1}if(!Scule.global.functions.isInteger(t)){throw"Unable to increment counter with non-integer value"}this.count+=t;return this.count};this.decrement=function(t){if(t===undefined){t=1}if(!Scule.global.functions.isInteger(t)){throw"Unable to decrement counter with non-integer value"}this.count-=t;return this.count};this.getCount=function(){return this.count}};Scule.getLinkedList=function(){return new Scule.datastructures.classes.LinkedList};Scule.getCachingLinkedList=function(t,e){return new Scule.datastructures.classes.CachingLinkedList(t,e)};Scule.getDoublyLinkedList=function(){return new Scule.datastructures.classes.DoublyLinkedList};Scule.getHashTable=function(){return new Scule.datastructures.classes.HashTable};Scule.getPrimaryKeyIndex=function(){return new Scule.db.classes.PrimaryKeyIndex};Scule.getHashMap=function(t){return new Scule.datastructures.classes.HashMap(t)};Scule.getLIFOStack=function(){return new Scule.datastructures.classes.LIFOStack};Scule.getFIFOStack=function(){return new Scule.datastructures.classes.FIFOStack};Scule.getQueue=function(){return new Scule.datastructures.classes.Queue};Scule.getLRUCache=function(t){return new Scule.datastructures.classes.LRUCache(t)};Scule.getBinarySearchTreeNode=function(t,e){return new Scule.datastructures.classes.BinarySearchTreeNode(t,e)};Scule.getBinarySearchTree=function(){return new Scule.datastructures.classes.BinarySearchTree};Scule.getAtomicCounter=function(t){return new Scule.datastructures.classes.AtomicCounter(t)};Scule.getBitSet=function(t){return new Scule.datastructures.classes.BitSet(t)};Scule.getBloomFilter=function(t){return new Scule.datastructures.classes.BloomFilter(t)}})();(function(){Scule.instrumentation.classes.Timer=function(){this.intervalCounter=0;this.intervalArray=[];this.intervals=Scule.getLIFOStack();this.resetTimer=function(){this.intervalCounter=0;this.intervalArray=[];this.intervals.clear()};this.startInterval=function(t){this.intervalCounter++;if(t===undefined){t=this.intervalCounter}this.intervals.push(new Scule.instrumentation.classes.TimerInterval(t));this.intervalArray.push(this.intervals.peek())};this.stopInterval=function(){if(this.intervals.isEmpty()){return false}this.intervals.peek().stop();return this.intervals.pop()};this.stopAllIntervals=function(){while(!this.intervals.isEmpty()){this.intervals.pop().stop()}};this.logToConsole=function(){this.intervalArray.forEach(function(t){t.logToConsole()})}};Scule.instrumentation.classes.TimerInterval=function(t){this.startTimestamp=(new Date).getTime();this.endTimestamp=null;this.tag=t;this.stopped=function(){return this.endTimestamp!==null};this.stop=function(){this.endTimestamp=(new Date).getTime()};this.getDifference=function(){if(this.endTimestamp===null){return false}return this.endTimestamp-this.startTimestamp};this.logToConsole=function(){var t=this.getDifference();if(t===false){console.log("interval "+this.tag+" is still in progress")}console.log("interval "+this.tag+" lasted "+t+"ms")}};Scule.getTimer=function(){return new Scule.instrumentation.classes.Timer}})();(function(){Scule.interpreter.symbols.table={$and:Scule.interpreter.arities.selective,$or:Scule.interpreter.arities.selective,$nor:Scule.interpreter.arities.negative,$not:Scule.interpreter.arities.negative,$lt:Scule.interpreter.arities.range,$lte:Scule.interpreter.arities.range,$gt:Scule.interpreter.arities.range,$gte:Scule.interpreter.arities.range,$all:Scule.interpreter.arities.array,$in:Scule.interpreter.arities.array,$nin:Scule.interpreter.arities.array,$elemMatch:Scule.interpreter.arities.array,$eq:Scule.interpreter.arities.binary,$ne:Scule.interpreter.arities.binary,$size:Scule.interpreter.arities.binary,$exists:Scule.interpreter.arities.binary,$within:Scule.interpreter.arities.geospatial,$near:Scule.interpreter.arities.geospatial,$set:Scule.interpreter.arities.mutate,$inc:Scule.interpreter.arities.mutate,$unset:Scule.interpreter.arities.mutate,$pull:Scule.interpreter.arities.mutate,$pullAll:Scule.interpreter.arities.mutate,$pop:Scule.interpreter.arities.mutate,$push:Scule.interpreter.arities.mutate,$pushAll:Scule.interpreter.arities.mutate,$rename:Scule.interpreter.arities.mutate};Scule.interpreter.classes.QueryNormalizer=function(){this.normalize=function(t){var e=function(t){for(var i in t){if(Scule.global.functions.isScalar(t[i])||t[i]instanceof RegExp||t[i]instanceof Scule.db.classes.ObjectId){var n=t[i];if(n instanceof Scule.db.classes.ObjectId){n=t[i].toString()}delete t[i];t[i]={$eq:n}}else{if(i==="$or"){if(Scule.global.functions.isArray(t[i])){t[i].forEach(function(t){e(t)})}}else if(i==="$elemMatch"){e(t[i])}else if(i==="$where"){}else{t[i]=Scule.global.functions.sortObjectKeys(t[i])}}}return Scule.global.functions.sortObjectKeys(t)};return e(t)}};Scule.interpreter.classes.DateComparator=function(){this.isDate=function(t){return t instanceof Date||t instanceof Scule.db.classes.ObjectDate};this.normalizeDate=function(t){if(!this.isDate(t)){throw new Error("unable to compare non-date object")}if(t instanceof Scule.db.classes.ObjectDate){return t.toDate().getTime()}if(t instanceof Date){return t.getTime()}return t};this.$eq=function(t,e){return this.normalizeDate(t)==this.normalizeDate(e)};this.$gt=function(t,e){return this.normalizeDate(t)>this.normalizeDate(e)};this.$gte=function(t,e){return this.normalizeDate(t)>=this.normalizeDate(e)};this.$lt=function(t,e){return this.normalizeDate(t)<this.normalizeDate(e)};this.$lte=function(t,e){return this.normalizeDate(t)<=this.normalizeDate(e)}};Scule.interpreter.classes.QueryEngine=function(){this.comparator=new Scule.interpreter.classes.DateComparator;this.traverse=function(t,e){return Scule.global.functions.traverse(t,e)};this.traverseObject=function(t,e){return Scule.global.functions.traverseObject(Scule.global.functions.parseAttributes(t),e)};this.$ne=function(t,e){return!this.$eq(t,e)};this.$eq=function(t,e){if(e instanceof RegExp){return e.test(t)}else if(t instanceof Scule.db.classes.ObjectId){return t.toString()==e}else{if(this.comparator.isDate(t)&&this.comparator.isDate(e)){return this.comparator.$eq(t,e)}return t==e}};this.$gt=function(t,e){if(this.comparator.isDate(t)&&this.comparator.isDate(e)){return this.comparator.$gt(t,e)}return t>e};this.$gte=function(t,e){if(this.comparator.isDate(t)&&this.comparator.isDate(e)){return this.comparator.$gte(t,e)}return t>=e};this.$lt=function(t,e){if(this.comparator.isDate(t)&&this.comparator.isDate(e)){return this.comparator.$lt(t,e)}return t<e};this.$lte=function(t,e){if(this.comparator.isDate(t)&&this.comparator.isDate(e)){return this.comparator.$lte(t,e)}return t<=e};this.$all=function(t,e){if(!Scule.global.functions.isArray(t)||!Scule.global.functions.isArray(e)){return false}var i=0;var n={};for(i=0;i<t.length;i++){n[t[i]]=true}for(i=0;i<e.length;i++){if(!n.hasOwnProperty(e[i])){return false}}return true};this.$in=function(t,e){for(var i=0;i<e.length;i++){if(this.$eq(t,e[i])){return true}}return false};this.$nin=function(t,e){for(var i=0;i<e.length;i++){if(this.$eq(t,e[i])){return false}}return true};this.$where=function(t,e){return e.call(t)};this.$elemMatch=function(t,e){if(!Scule.global.functions.isArray(t)){return false}for(var i=0;i<t.length;i++){if(e(t[i])){return true}}return false};this.$size=function(t,e){if(!Scule.global.functions.isInteger(e)){return false}return Scule.global.functions.sizeOf(t)===e};this.$exists=function(t,e){if(e){return t!==undefined}return t===undefined};this.$within=function(t,e){if(!t.hasOwnProperty("lat")||!t.hasOwnProperty("lon")){return false}if(!e.hasOwnProperty("lat")||!e.hasOwnProperty("lon")){return false}var i=Math.sqrt(Math.pow(e.lat-t.lat,2)+Math.pow(e.lon-t.lon,2));return i<=e.distance};this.$near=function(t,e){if(!t.hasOwnProperty("lat")||!t.hasOwnProperty("lon")){return false}if(!e.hasOwnProperty("lat")||!e.hasOwnProperty("lon")){return false}var i=Math.acos(Math.sin(t.lat)*Math.sin(e.lat)+Math.cos(t.lat)*Math.cos(e.lat)*Math.cos(e.lon-t.lon))*6371;return i<=e.distance};this.$sort=function(t,e,i){Scule.global.functions.sort(t,e,i)};this.$set=function(t,e,i){var n=t[0];var r=t[1];if(!(n in r)){if(i===true){r[n]=e}}else{r[n]=e}};this.$unset=function(t){var e=t[0];var i=t[1];if(e in i){delete i[e]}};this.$inc=function(t,e,i){if(!Scule.global.functions.isInteger(e)){e=1}var n=t[0];var r=t[1];if(!(n in r)){if(i){r[n]=e}}else{if(Scule.global.functions.isInteger(r[n])||Scule.global.functions.isDouble(r[n])){r[n]+=e}}};this.$pull=function(t,e){var i=t[0];var n=t[1];if(i in n&&Scule.global.functions.isArray(n[i])){var r=[];for(var s=0;s<n[i].length;s++){if(n[i][s]!==e){r.push(n[i][s])}}n[i]=r}};this.$pullAll=function(t,e){var i=t[0];var n=t[1];if(i in n&&Scule.global.functions.isArray(n[i])){if(!Scule.global.functions.isArray(e)){throw"the $pullAll operator requires an associated array as an operand"}var r=Scule.getHashTable();e.forEach(function(t){r.put(t,true)});for(var s=0;s<n[i].length;s++){if(r.contains(n[i][s])){n[i].splice(s,1);s--}}}};this.$pop=function(t){var e=t[0];var i=t[1];if(e in i&&Scule.global.functions.isArray(i[e])){i[e].pop()}};this.$push=function(t,e,i){var n=t[0];var r=t[1];if(!(n in r)&&i){r[n]=[e]}else{if(Scule.global.functions.isArray(r[n])){r[n].push(e)}}};this.$pushAll=function(t,e,i){var n=t[0];var r=t[1];if(!(n in r)&&i){r[n]=e.slice(0)}else{if(!Scule.global.functions.isArray(e)){throw"the $pushAll operator requires an associated array as an operand"}if(Scule.global.functions.isArray(r[n])){e.forEach(function(t){r[n].push(t)})}}}};Scule.interpreter.classes.QueryCompiler=function(){this.cache=Scule.getHashTable();this.engine=new Scule.interpreter.classes.QueryEngine;this.normalizer=new Scule.interpreter.classes.QueryNormalizer;this.compileConditions=function(t){var e="";var i,n;if(t.hasOwnProperty("$sort")){i=t.$sort;n=Scule.global.functions.objectKeys(i);if(n.length===1){e+="	engine.$sort("+i[n[0]]+', r, "'+n[0]+'");\n'}}if(t.hasOwnProperty("$skip")){e+="	r.splice(0, "+t.$skip+");\n"}if(t.hasOwnProperty("$limit")){e+="	if (r.length > "+t.$limit+") {\n";e+="		r.splice("+t.$limit+");\n";e+="	}\n"}return e};this.compileClauseList=function(t){var e=this;var i=[];if(!Scule.global.functions.isArray(t)){return i}t.forEach(function(t){var n=[];for(var r in t){if(!t.hasOwnProperty(r)){continue}n=n.concat(e.compileQueryClauses(r,t[r]))}i.push(n.join(" && "))});return"("+i.join(") || (")+")"};this.compileExpressions=function(t){t=this.normalizer.normalize(t);var e=[];for(var i in t){e=e.concat(this.compileQueryClauses(i,t[i]))}return e};this.compileQueryClauses=function(t,e){var i=[];for(var n in e){if(!this.engine.hasOwnProperty(n)){continue}if(n==="$elemMatch"){var r=this.compileExpressions(e[n]);var s="function(o) { return ("+r.join(" && ")+"); }";if(t.indexOf(".")<0){i.push("engine.$elemMatch(o."+t+", "+s+")")}else{i.push("engine.$elemMatch(engine.traverse("+JSON.stringify(t)+", o), "+s+")")}}else{var a=null;if(e[n]instanceof RegExp){a=e[n].toString()}else if(e[n]instanceof Date){a='new Date("'+e[n].toString()+'")'}else if(e[n]instanceof Scule.db.classes.ObjectDate){a='new Date("'+e[n].toDate().toString()+'")'}else{a=JSON.stringify(e[n])}if(t.indexOf(".")<0){i.push("engine."+n+"(o."+t+", "+a+")")}else{i.push("engine."+n+"(engine.traverse("+JSON.stringify(t)+", o), "+a+")")}}}return i};this.compileUpdateClauses=function(t,e,i){if(!this.engine.hasOwnProperty(t)){return}var n=[];for(var r in e){n.push("		engine."+t+"(engine.traverseObject("+JSON.stringify(r)+", o), "+JSON.stringify(e[r])+", "+JSON.stringify(i)+");")}return n};this.compileUpdate=function(query,upsert,ignoreCache){var hash=Scule.md5.hash(this.serializeQuery(query));if(this.cache.contains(hash)){return this.cache.get(hash)}var updates=[];var closure="var u = function(objects, collection, engine) {\n";closure+="	objects.forEach(function(o) {\n";for(var key in query){if(!query.hasOwnProperty(key)){continue}updates=updates.concat(this.compileUpdateClauses(key,query[key],upsert))}closure+=updates.join("\n");closure+="\n	});\n";closure+="	return objects;\n";closure+="}\n";if(ignoreCache){return closure}eval(closure);this.cache.put(hash,u);return this.cache.get(hash)};this.serializeQuery=function(t){var e=Scule.global.functions.cloneObject(t);var i=function(t){for(var e in t){if(t[e]instanceof Scule.db.classes.ObjectId||t[e]instanceof RegExp){t[e]=t[e].toString()}else{if(!Scule.global.functions.isScalar(t[e])){i(t[e])}}}};i(e);return JSON.stringify(e)};this.compileQuery=function(query,conditions,ignoreCache){query=this.normalizer.normalize(query);var hash=Scule.md5.hash(this.serializeQuery(query)+this.serializeQuery(conditions));if(this.cache.contains(hash)){return this.cache.get(hash)}var closure="var c = function(objects, engine) {\n";closure+="	var r = [];\n";if(Scule.global.functions.sizeOf(query)>0){closure+="	objects.forEach(function(o) {\n";closure+="		o = o.element;\n";var ands=[];var ors="";for(var key in query){if(!query.hasOwnProperty(key)){continue}if(key==="$or"){ors="("+this.compileClauseList(query[key])+")"}else if(key==="$where"){ands=ands.concat(["engine.$where(o, "+query[key].toString()+")"])}else{ands=ands.concat(this.compileQueryClauses(key,query[key]))}}if(ands.length>0){if(ors.length>0){ors=" && "+ors}closure+="		if (("+ands.join(" && ")+")"+ors+") {\n";closure+="			r[r.length] = o;\n";closure+="		}\n"}else if(ors.length>0){closure+="		if ("+ors+") {\n";closure+="			r[r.length] = o;\n";closure+="		}\n"}closure+="	});\n"}else{closure+="	r = objects.toArray();\n"}if(conditions){closure+=this.compileConditions(conditions)}closure+="	return r;\n";closure+="};\n";if(ignoreCache){return closure}eval(closure);this.cache.put(hash,c);return this.cache.get(hash)};this.explainQuery=function(t,e){var i=this.compileQuery(t,e,true);console.log(i);return i};this.explainUpdate=function(t,e){var i=this.compileUpdate(t,e,true);console.log(i);return i}};Scule.interpreter.classes.QueryInterpreter=function(){this.compiler=new Scule.interpreter.classes.QueryCompiler;this.interpret=function(t,e,i,n){if(n){return this.compiler.explainQuery(e,i)}var r=t.documents.queue;var s=this.compiler.compileQuery(e,i);return s(r,Scule.interpreter.objects.engine)};this.update=function(t,e,i,n,r,s){var a=this.interpret(t,e,n,s);if(s){return this.compiler.explainUpdate(i,r)}var u=this.compiler.compileUpdate(i,r);return u(a,t,Scule.interpreter.objects.engine)}};Scule.interpreter.objects.engine=new Scule.interpreter.classes.QueryEngine;Scule.getQueryNormalizer=function(){return new Scule.interpreter.classes.QueryNormalizer};Scule.getQueryEngine=function(){return new Scule.interpreter.classes.QueryEngine};Scule.getQueryCompiler=function(){return new Scule.interpreter.classes.QueryCompiler};Scule.getQueryInterpreter=function(){return new Scule.interpreter.classes.QueryInterpreter};Scule.getDateComparator=function(){return new Scule.interpreter.classes.DateComparator}})();(function(){Scule.db.classes.SimpleCryptographyProvider=function(){this.signString=function(t,e,i){return Scule.sha1.hash(Scule.sha1.hash(t+e)+i)};this.signObject=function(t,e,i){t._sig=i;return this.signString(JSON.stringify(t),e,i)};this.signJSONString=function(t,e,i){return this.signString(JSON.stringify(t),e,i)};this.verifyObjectSignature=function(t,e,i){var n=t._sig;var r=this.signObject(t,e,i);return n===r}};Scule.db.classes.StorageEngine=function(t){this.configuration=t;this.crypto=null;this.setConfiguration=function(t){this.configuration=t};this.getConfiguration=function(){return this.configuration};this.setCryptographyProvider=function(t){this.crypto=t};this.getCryptographyProvider=function(){return this.crypto}};Scule.db.classes.DummyStorageEngine=function(t){Scule.db.classes.StorageEngine.call(this,t);this.write=function(t,e,i){if(i){i(e)}};this.read=function(t,e){if(e){e()}}};Scule.db.classes.MemoryStorageEngine=function(t){Scule.db.classes.StorageEngine.call(this,t);this.setCryptographyProvider(new Scule.db.classes.SimpleCryptographyProvider);this.storage={};this.write=function(t,e,i){if(!e._salt){e._salt=Scule.sha1.hash((new Date).getTime()+"")}e._sig=this.crypto.signObject(e,this.configuration.secret,e._salt);this.storage["__scule_collection__"+t]=JSON.stringify(e);if(i){i(e)}};this.read=function(t,e){if(!("__scule_collection__"+t in this.storage)){var i={_sig:null,_salt:Scule.sha1.hash((new Date).getTime()+""),_version:3,_name:t,_objects:{}};i._sig=this.crypto.signObject(i,this.configuration.secret,i._salt);this.storage["__scule_collection__"+t]=JSON.stringify(i)}var n=this.storage["__scule_collection__"+t];var r=JSON.parse(n);if(this.crypto.verifyObjectSignature(r,this.configuration.secret,r._salt)===false){throw JSON.stringify({event:"SculeDataTampered",filename:this.configuration.collection})}delete r._sig;if(e){e(r)}}};Scule.db.classes.LocalStorageStorageEngine=function(t){Scule.db.classes.StorageEngine.call(this,t);this.setCryptographyProvider(new Scule.db.classes.SimpleCryptographyProvider);if(!window||!window.hasOwnProperty("localStorage")&&window.localStorage!==null){throw JSON.stringify({event:"SculeLocalStorageError",message:"Local storage is not available on this device"})}this.write=function(t,e,i){if(!e._salt){e._salt=Scule.sha1.hash((new Date).getTime()+"")}try{e._sig=this.crypto.signObject(e,this.configuration.secret,e._salt);localStorage.setItem("__scule_collection__"+t,JSON.stringify(e));if(i){i(e)}}catch(n){throw JSON.stringify({event:"SculeLocalStorageError",message:"Storage quota exceeded for origin",collection:this.configuration.collection})}};this.read=function(t,e){var i=localStorage.getItem("__scule_collection__"+t);var n={};if(!i){n={_sig:null,_salt:Scule.sha1.hash((new Date).getTime()+""),_version:3,_name:t,_objects:{}}}else{n=JSON.parse(i);if(this.crypto.verifyObjectSignature(n,this.configuration.secret,n._salt)===false){throw JSON.stringify({event:"SculeDataTampered",filename:this.configuration.collection})}delete n._sig}if(e){e(n)}}};Scule.db.classes.TitaniumDiskStorageEngine=function(t){Scule.db.classes.StorageEngine.call(this,t);if(!this.configuration.path){this.configuration.path=Titanium.Filesystem.applicationDataDirectory}this.setConfiguration=function(t){this.configuration=t;if(!this.configuration.path){this.configuration.path=Titanium.Filesystem.applicationDataDirectory}};this.setCryptographyProvider(new Scule.db.classes.SimpleCryptographyProvider);this.write=function(t,e,i){if(!e._salt){e._salt=Scule.sha1.hash((new Date).getTime()+"")}e._sig=this.crypto.signObject(e,this.configuration.secret,e._salt);var n=Titanium.Filesystem.getFile(this.configuration.path,t+".json");n.write(JSON.stringify(e));if(i){i(e)}return true};this.read=function(t,e){var i=Titanium.Filesystem.getFile(this.configuration.path,t+".json");if(i.exists()){var n=JSON.parse(i.read());if(this.crypto.verifyObjectSignature(n,this.configuration.secret,n._salt)===false){Ti.App.fireEvent("SculeDataTampered",{filename:t});return false}delete n._sig;if(e){e(n)}return n}return false}};Scule.db.classes.NodeJSDiskStorageEngine=function(t){Scule.db.classes.StorageEngine.call(this,t);this.filesystem=require("fs");this.setCryptographyProvider(new Scule.db.classes.SimpleCryptographyProvider);this.write=function(t,e,i){var n=this.configuration.path+"/"+t+".json";if(!e._salt){e._salt=Scule.sha1.hash((new Date).getTime()+"")}e._sig=this.crypto.signObject(e,this.configuration.secret,e._salt);this.filesystem.writeFile(n,JSON.stringify(e),function(t){if(t){throw t}if(i){i(e)}})};this.read=function(t,e){var i=this.configuration.path+"/"+t+".json";var n=this;this.filesystem.exists(i,function(r){if(!r){return e({})}n.filesystem.readFile(i,function(i,r){if(i){throw i}var s=JSON.parse(r);if(s._version>2){if(n.crypto.verifyObjectSignature(s,n.configuration.secret,s._salt)===false){throw JSON.stringify({event:"SculeDataTampered",filename:t})}}delete s._sig;if(e){e(s)}})})}};Scule.db.classes.ObjectId=function(t){if(t===undefined){var e=Math.floor((new Date).getTime()/1e3).toString(16);var i=Scule.md5.hash(Scule.global.functions.getMACAddress()).substring(0,6);var n=Scule.global.functions.randomFromTo(1e3,9999).toString(16);while(n.length<4){n="0"+n}var r=Scule.global.functions.randomFromTo(1e5,999999).toString(16);while(r.length<6){r="0"+r}t=e+i+n+r}this.id=t;this.$type="id";this.toString=function(){return this.id.toString()}};Scule.db.classes.ObjectDate=function(t,e){if(t===undefined&&e===undefined){var i=(new Date).getTime().toString();t=parseInt(i.substring(0,10),10);e=parseInt(i.substring(10),10)}this.ts=parseInt(t+e,10);this.sec=t;this.usec=e;this.$type="date";this.getTimestamp=function(){return this.ts};this.getSeconds=function(){return this.sec};this.getMicroSeconds=function(){return this.usec};this.toDate=function(){return new Date(this.sec*1e3+this.usec)}};Scule.db.classes.DBRef=function(t,e){if(t===undefined||e===undefined){throw"illegal object reference"}this.ref=t;this.id=new Scule.db.classes.ObjectId(e);this.$type="dbref";this.getRef=function(){return this.ref};this.getId=function(){return this.id};this.resolve=function(){return this.resolveReference()};this.resolveReference=function(){var t=Scule.factoryCollection(this.ref);return t.findOne(this.id)}};Scule.db.classes.PrimaryKeyIndex=function(){this.table=Scule.getHashTable();this.queue=Scule.getDoublyLinkedList();this.clear=function(){this.table.clear();this.queue.clear()};this.contains=function(t){return this.table.contains(t)};this.get=function(t){if(!this.table.contains(t)){return null}return this.table.get(t).element};this.add=function(t){var e=Scule.global.functions.getObjectId(t,true);if(this.table.contains(e)){this.remove(t)}this.table.put(e,this.queue.add(t));return true};this.remove=function(t){var e=Scule.global.functions.getObjectId(t,true);if(!this.table.contains(e)){return false}var i=this.table.remove(e);if(!i){return false}var n=i.prev;var r=i.next;if(n){n.next=r}if(r){r.prev=n}i.detach();if(i===this.queue.head){this.queue.head=r}else if(i===this.queue.tail){this.queue.tail=n}if(this.queue.head===this.queue.tail){this.queue.tail=null}this.queue.length--;return i.element};this.length=function(){return this.queue.length};this.toTable=function(){var t={};this.queue.forEach(function(e){t[Scule.global.functions.getObjectId(e.element,true)]=e.element});return t};this.toArray=function(){return this.queue.toArray()};this.toString=function(){var t="(h) ";this.queue.forEach(function(e){t+=JSON.stringify(e.element)+" -> "});t+="(t)";return t}};Scule.db.classes.Collection=function(t){this.documents=Scule.getPrimaryKeyIndex();this.interpreter=Scule.getQueryInterpreter();this.version=3;this.lastId=null;this.name=t;this.autoCommit=false;this.isOpen=false;this.storage=null;this.setStorageEngine=function(t){this.storage=t};this.setAutoCommit=function(t){this.autoCommit=t};this.getName=function(){return this.name};this.getLength=function(){return this.documents.length()};this.getLastInsertId=function(){return this.lastId};this.open=function(t){if(this.isOpen){return}var e=this;this.storage.read(this.name,function(i){if(!i){return}for(var n in i._objects){if(i._objects.hasOwnProperty(n)){var r=i._objects[n];Scule.db.functions.unflattenObject(i._objects[n]);e.documents.add(r)}}e.isOpen=true;if(t){t(this)}})};this.commit=function(t){var e={_sig:null,_salt:null,_name:this.name,_version:this.version,_objects:this.documents.toTable()};this.storage.write(this.name,e,t)};this.find=function(t,e,i){if(Scule.global.constants.ID_FIELD in t){return[this.findOne(t[Scule.global.constants.ID_FIELD])]}var n=this.interpreter.interpret(this,t,e);if(i){i(n)}return n};this.explain=function(t,e,i){this.interpreter.interpret(this,t,e,true);if(i){i()}};this.clear=function(t){this.documents.clear();if(t){t(this)}};this.findAll=function(t){var e=this.documents.toArray();if(t){t(e)}return e};this.findOne=function(t,e){if(!Scule.global.functions.isScalar(t)){t=t.toString()}var i=null;if(this.documents.contains(t)){i=this.documents.get(t)}if(e){e(i)}return i};this.save=function(t,e){Scule.db.functions.unflattenObject(t);if(t.hasOwnProperty("_id")){if(!(t._id instanceof Scule.db.classes.ObjectId)){t._id=new Scule.db.classes.ObjectId(t._id)}}this.documents.add(t);if(this.autoCommit){this.commit()}this.lastId=Scule.global.functions.getObjectId(t);if(e){e(this.lastId)}return this.lastId};this.update=function(t,e,i,n,r){var s=this.interpreter.update(this,t,e,i,n);if(r){r(s)}return s};this.count=function(t,e,i){var n=this.find(t,e).length;if(i){i(n)}return n};this.remove=function(t,e,i){var n=this;var r=this.find(t,e);r.forEach(function(t){n.documents.remove(t)});if(i){i(r)}return r};this.distinct=function(t,e,i){var n=this.find(e);var r={};n.forEach(function(e){if(!(e[t]in r)){r[e[t]]=0}r[e[t]]++});if(i){i(r)}return r};this.merge=function(t,e){if(!t){throw"the merge function requires a valid collection as a parameter"}var i=this;var n=t.findAll();n.forEach(function(t){if(!i.documents.contains(t._id)){i.documents.add(t)}});if(e){e(this)}return true};this.mapReduce=function(t,e,i,n){new Scule.db.classes.MapReduceHandler(t,e,i).run(this,n)}};Scule.db.classes.MapReduceHandler=function(t,e,i){this.options=i;if(!t){throw"A valid function is requires as the `map` parameter of the map/reduce operation"}if(!e){throw"A valid function is requires as the `reduce` parameter of the map/reduce operation"}if(!("out"in i)){throw"A valid output collection connection url is required as the `out` parameter of the map/reduce options object"}else{if(!("merge"in i.out)&&!("reduce"in i.out)){throw"A valid output collection connection url is required as either the `merge` or `reduce` out parameter of the map/reduce options object"}}if(!("query"in i)){i.query={}}if(!("conditions"in i)){i.conditions={}}this.map=t;this.reduce=e;this.finalize="finalize"in i?i.finalize:null;this.run=function(t,e){var i=this;var n="merge"in this.options.out;var r=Scule.factoryCollection(n?this.options.out.merge:this.options.out.reduce);var s=Scule.getHashTable();var a=function(t,e){if(!s.contains(t)){s.put(t,[])}s.get(t).push(e)};var u=t.find(this.options.query,this.options.conditions);u.forEach(function(t){i.map(t,a)});var c=null;if(n){c=Scule.factoryCollection("scule+dummy://__mr"+(new Date).getTime())}var l=Scule.getHashTable();var o=s.getKeys();o.forEach(function(t){l.put(t,i.reduce(t,s.get(t)));if(i.finalize){l.put(t,i.finalize(t,l.get(t)))}if(!n){r.save(l.get(t))}else{c.save(l.get(t))}});if(n){r.merge(c)}if(e){e(r)}return true}};Scule.db.classes.CollectionFactory=function(){this.collections=Scule.getHashTable();this.getCollection=function(t,e){if(this.collections.contains(t)){return this.collections.get(t).c}if(!e){e={secret:"dummy"}}var i=Scule.db.functions.parseCollectionURL(t);if(!(i.plugin in Scule.db.plugins)){throw i.plugin+" is not a registered Scule plugin"}if(!(i.engine in Scule.db.engines)){throw i.engine+" is nto a registered Scule storage engine"}var n=new Scule.db.engines[i.engine](e);var r=new Scule.db.plugins[i.plugin](i.name);r.setStorageEngine(n);r.open();this.collections.put(t,{c:r,t:(new Date).getTime()});return this.collections.get(t).c}};Scule.db.functions.debug=function(t){if(Scule.db.global.debug===true){console.log(t)}};Scule.db.functions.unflattenObject=function(t){var e=function(t){if(Scule.global.functions.isScalar(t)){return}for(var i in t){if(t.hasOwnProperty(i)){var n=t[i];if(!Scule.global.functions.isScalar(n)&&n&&"$type"in n){switch(n.$type){case"date":t[i]=new Scule.db.classes.ObjectDate(n.sec,n.usec);t[i].ts=n.ts;break;case"id":t[i]=new Scule.db.classes.ObjectId(n.id);break;case"dbref":t[i]=new Scule.db.classes.DBRef(n.ref,n.id);break}}else{e(n)}}}};e(t);if(!(Scule.global.constants.ID_FIELD in t)){t[Scule.global.constants.ID_FIELD]=new Scule.db.classes.ObjectId}};Scule.db.functions.parseCollectionURL=function(t){var e=t.match(/^([^\+]*)\+([^\/]*)\:\/\/(.*)/);if(!e||e.length!==4){throw t+" is an invalid collection url"}return{plugin:e[1],engine:e[2],name:e[3]}};Scule.db.objects.core.collections.factory=new Scule.db.classes.CollectionFactory;Scule.debug=function(t){Scule.global.variables.debug=t};Scule.registerStorageEngine=function(t,e){if(t in Scule.db.engines){throw t+" storage engine is already registered"}Scule.db.engines[t]=e};Scule.registerCollectionPlugin=function(t,e){if(t in Scule.db.plugins){throw t+" collection plugin is already registered"}Scule.db.plugins[t]=e};(function(){Scule.registerStorageEngine("memory",Scule.db.classes.MemoryStorageEngine);Scule.registerStorageEngine("dummy",Scule.db.classes.DummyStorageEngine);Scule.registerStorageEngine("local",Scule.db.classes.LocalStorageStorageEngine);Scule.registerStorageEngine("nodejs",Scule.db.classes.NodeJSDiskStorageEngine);Scule.registerStorageEngine("titanium",Scule.db.classes.TitaniumDiskStorageEngine);Scule.registerCollectionPlugin("scule",Scule.db.classes.Collection)})();Scule.factoryCollection=function(t,e){return Scule.db.objects.core.collections.factory.getCollection(t,e)};Scule.dropAll=function(){Scule.db.objects.core.collections.factory.collections.clear()};Scule.getIndex=function(){return new Scule.db.classes.Index};Scule.getHashTableIndex=function(t){return new Scule.db.classes.HashTableIndex(t)};Scule.getObjectId=function(t){return new Scule.db.classes.ObjectId(t)};Scule.getObjectDate=function(t,e){return new Scule.db.classes.ObjectDate(t,e)};Scule.getObjectDateFromDate=function(t){if(!(t instanceof Date)){throw new Error("unable to factory ObjectDate from non-date object")}var e=t.getTime().toString();var i=parseInt(e.substring(0,10),10);var n=parseInt(e.substring(10),10);return new Scule.db.classes.ObjectDate(i,n)};Scule.getDBRef=function(t,e){return new Scule.db.classes.DBRef(t,e)};Scule.getMemoryStorageEngine=function(t){return new Scule.db.classes.MemoryStorageEngine(t)};Scule.getLocalStorageStorageEngine=function(t){return new Scule.db.classes.LocalStorageStorageEngine(t)};Scule.getNodeJSDiskStorageEngine=function(t){return new Scule.db.classes.NodeJSDiskStorageEngine(t)};Scule.getTitaniumDiskStorageEngine=function(t){return new Scule.db.classes.TitaniumDiskStorageEngine(t)};Scule.getSimpleCryptographyProvider=function(){return new Scule.db.classes.SimpleCryptographyProvider}})();(function(){if(typeof Titanium!=="undefined"&&typeof Titanium.Platform!=="undefined"){Scule.md5={hash:function(t){return Ti.Utils.md5HexDigest(t)}};Scule.sha1={hash:function(t){return Ti.Utils.sha1(t)}};module.exports=Scule}else{if(typeof exports!=="undefined"&&this.exports!==exports){Scule.md5={m:require("crypto"),hash:function(t){return this.m.createHash("md5").update(t).digest("hex")}};Scule.sha1={m:require("crypto"),hash:function(t){return this.m.createHash("sha1").update(t).digest("hex")}};module.exports=Scule}else{Scule.global.system.installHashFunctions()}}})();